#include "ClipAnalysisUtils.h"
#include "GetBpmFromOdfXcorr.h"

#include <catch2/catch.hpp>

namespace
{
// Nothing else matters, two bars of the introductory riff.
constexpr auto playDur = 5.075;
const std::vector<double> interpOdfVals = {
   0,          0,          0.00047554, 0,          0.0187093,  0.0408743,
   0.00832413, 0.00664293, 0.00587361, 0.00802387, 0.00725199, 0.00496669,
   0.00653865, 0.00420077, 0.00689967, 0.0104533,  0.0108599,  0.00843276,
   0.00616253, 0.00580006, 0.0060873,  0.00513904, 0.00547207, 0.00332423,
   0.00863683, 0.0267449,  0.0279202,  0.0142263,  0.0165204,  0.0176435,
   0.0138249,  0.0139944,  0.00729236, 0.0107942,  0.00712916, 0.0285155,
   0.0461264,  0.0315073,  0.0169728,  0.0176507,  0.0144046,  0.0170575,
   0.0181704,  0.0158386,  0.0141687,  0.00727162, 0.0184376,  0.0320181,
   0.0265286,  0.0187438,  0.0203874,  0.0133743,  0.011961,   0.0151681,
   0.0142175,  0.0143782,  0.0126654,  0.0186256,  0.0610163,  0.0283931,
   0.0123166,  0.0157951,  0.0145404,  0.0132107,  0.0123231,  0.0121473,
   0.00988312, 0.0227583,  0.0640293,  0.0834675,  0.0387674,  0.016641,
   0.0129562,  0.0125272,  0.0117356,  0.00983304, 0.00715961, 0.00936812,
   0.00934317, 0.0196271,  0.0191824,  0.0137519,  0.0158502,  0.0127007,
   0.0102243,  0.00917335, 0.00792385, 0.00756601, 0.00591681, 0.00960137,
   0.0336787,  0.0283041,  0.0165394,  0.00857231, 0.00673591, 0.0105641,
   0.0111706,  0.00822159, 0.00998322, 0.00637309, 0.0190193,  0.0383835,
   0.0278355,  0.0244536,  0.0198193,  0.0169373,  0.0160246,  0.0153256,
   0.015554,   0.0165319,  0.0103355,  0.0324782,  0.047366,   0.0353191,
   0.0206045,  0.0198854,  0.0172361,  0.0138423,  0.0141804,  0.016536,
   0.0160791,  0.0220712,  0.0491016,  0.0475178,  0.0254142,  0.0166397,
   0.0193708,  0.0150842
};
} // namespace

TEST_CASE("GetBpmFromOdfXcorr")
{
   const auto xcorr = ClipAnalysis::GetNormalizedAutocorr(interpOdfVals);
   const auto result = ClipAnalysis::GetBpmFromOdfXcorr(xcorr, playDur);
}
